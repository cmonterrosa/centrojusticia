<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="bitacora" pageWidth="792" pageHeight="612" orientation="Landscape" whenNoDataType="BlankPage" columnWidth="770" leftMargin="11" rightMargin="11" topMargin="11" bottomMargin="11">
	<property name="ireport.zoom" value="2.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="144"/>
	<subDataset name="dataset1"/>
	<parameter name="APP_URL" class="java.lang.String"/>
	<parameter name="P_SUBDIRECCION" class="java.lang.String"/>
	<parameter name="P_INICIO" class="java.lang.String"/>
	<parameter name="P_FIN" class="java.lang.String"/>
	<parameter name="P_TRAMITES" class="java.lang.String"/>
	<parameter name="P_ANIO" class="java.lang.String"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["/home/cmonterrosa/NetBeansProjects/centrojusticia_sancris/app/reports/"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
	t.id,  UPPER(CONCAT(t.folio_expediente, ' / ', t.anio)) as numero_expediente,
	DATE_FORMAT(t.fechahora,'%d/%m/%Y %h:%i %p') as fecha_hora,
	comp.asunto,
        UPPER(CONCAT(u.nombre, ' ', u.paterno, ' ', u.materno )) as especialista
FROM tramites t

LEFT JOIN orientacions o
    ON o.tramite_id=t.id
LEFT JOIN users u
    ON o.user_id=u.id
LEFT JOIN comparecencias comp
    ON t.id = comp.tramite_id

WHERE
	(t.anio IS NOT NULL AND t.anio between YEAR($P{P_INICIO}) AND YEAR($P{P_FIN}) AND
        (t.folio_expediente IS NOT NULL OR t.only_orientacion IS NOT NULL) AND
        (t.fechahora between $P{P_INICIO} AND $P{P_FIN}))
ORDER BY
	t.fechahora DESC]]>
	</queryString>
	<field name="id" class="java.lang.Integer">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="fecha_hora" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="numero_expediente" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="asunto" class="java.lang.String">
		<fieldDescription><![CDATA[]]></fieldDescription>
	</field>
	<field name="especialista" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<pageHeader>
		<band height="107" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="2" width="763" height="23"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="12" isBold="false" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[BITACORA DE ATENCION]]></text>
			</staticText>
			<image scaleImage="FillFrame">
				<reportElement stretchType="RelativeToBandHeight" x="0" y="2" width="770" height="102" isPrintWhenDetailOverflows="true"/>
				<imageExpression class="java.lang.String"><![CDATA[$P{APP_URL} + "/app/reports/imagenes/encabezado-oficio.jpg"]]></imageExpression>
			</image>
			<textField>
				<reportElement x="442" y="66" width="328" height="13" forecolor="#721F1F"/>
				<textElement>
					<font size="11" isBold="false" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{P_SUBDIRECCION}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="442" y="45" width="328" height="16" forecolor="#751B1B"/>
				<textElement>
					<font fontName="Arial" size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[CENTRO ESTATAL DE JUSTICIA ALTERNATIVA]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="22" splitType="Stretch">
			<staticText>
				<reportElement x="120" y="0" width="95" height="22"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[NUM. EXP.]]></text>
			</staticText>
			<staticText>
				<reportElement x="226" y="0" width="371" height="22"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[ASUNTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="610" y="0" width="153" height="21"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="8" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[ESPECIALISTA/USUARIO QUE CAPTURÓ]]></text>
			</staticText>
			<staticText>
				<reportElement x="6" y="0" width="105" height="22"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA/HORA DE ATENCIÓN]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="44" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement x="120" y="2" width="95" height="20"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{numero_expediente}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement x="226" y="2" width="366" height="37" isPrintWhenDetailOverflows="true"/>
				<textElement textAlignment="Justified" verticalAlignment="Top">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{asunto}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="610" y="2" width="153" height="20"/>
				<textElement textAlignment="Left">
					<font size="8" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{especialista}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="6" y="2" width="105" height="20"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{fecha_hora}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band height="30" splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="26" splitType="Stretch">
			<textField>
				<reportElement x="461" y="0" width="199" height="20"/>
				<textElement textAlignment="Right">
					<font size="9"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Página "+$V{PAGE_NUMBER}+" de"]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report">
				<reportElement x="660" y="0" width="103" height="20"/>
				<textElement>
					<font size="9"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[" " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="48" splitType="Stretch">
			<textField>
				<reportElement x="20" y="14" width="276" height="20"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression class="java.lang.String"><![CDATA["Total de atenciones: "+$V{REPORT_COUNT}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
