<!-- Validate Plugin -->
<%=javascript_include_tag "validations/jquery_validate.js"%>
<%=javascript_include_tag "fancybox/jquery-1.8.0.min"%>

<%=javascript_include_tag :defaults%>




<script type="text/javascript">
		$j(document).ready(function() {
			/*
			 *  Simple image gallery. Uses default settings
			 */

			$j('.fancybox').fancybox();
               });

               /* Orientaciones */

$(function() {
    $j('#orientacion_fechahora').datetimepicker({
        dayOfWeekStart : 1,
        lang:'es'
    });
});

</script>

<%#*<script type="text/javascript">%>
<%#*$j(document).ready(function() {%>
  <%#*formulario = $j("#new_orientacion");%>
  <%#*formulario.submit(function() {%>
    <%#*$j.blockUI({%>
            <%#*message: '<h1><img src="/images/busy.gif" /> Procesando, por favor espere ...</h1>'%>
          <%#*});%>

        <%#*setTimeout($.unblockUI, 2000);%>
  <%#*})%>
<%#*})%>
<%#*</script>%>



<script  type="text/javascript">
  var statSend = false;
  function checkSubmit() {
    if (!statSend) {
        statSend = true;
        return true;
    } else {
        alert("El formulario ya se esta enviando...");
        return false;
    }
}
</script>

<p>
    <%= link_to image_tag("kolaval/ico-actualizar.jpg", :border =>0) , {:action => "new_or_edit"}, :title => "Recargar formulario"%>

   <%if current_user.has_role?("ranking")%>
    | <%=link_to image_tag('iconos_estadisticos/carga_trabajo.png', :size => "54x54", :mouseover => "iconos_estadisticos/carga_trabajo_2.png") , {:action => "show_siguientes_especialistas"}, :title => "Listado de especialistas siguientes", :class => "fancybox fancybox.iframe"%>
   <%end%>
</p>

    
<div class="formee container">
  
 <div class="formee-msg-info">
    <h3>Información importante</h3>
    <ul>
      <li>Los campos marcados con <em class="formee-req">*</em> son obligatorios.</li>
    </ul>
    <ul><li>&nbsp;</li></ul>
  </div>

   <%= stylesheet_link_tag "formee/formee-style.css" %>

  <% form_for :orientacion, @orientacion, :url => { :action => "save", :id => @orientacion }, :html => {:id => "new_orientacion", :onsubmit => "return checkSubmit();"} do |f| -%>
  <table width="94%" border="0" align="center" cellpadding="2" cellspacing="1">
    <tr>
     
      <fieldset>
      <legend style="font-size: 16px;">CAPTURA&nbsp;DE&nbsp;NUEVA&nbsp;ORIENTACIÓN</legend>

     <div class="grid-12-12" style="text-align: center;">
        <img alt="spinner" id="spinner" src="/images/loading_spinner.gif" style="display:none;" />
      </div>

     

    <%unless @especialista%>
      <div class="grid-10-12" id ="divespecialistas">

          <!-- primera linea -->
          <div class="grid-4-12">
            <label style=" font-weight: bold;">Fecha/hora:</label>
            <div class="grid-12-12">
            <%=f.text_field :fechahora, :value => @fecha%>
          </div>
        </div>

        <div class="grid-8-12"
            <label style=" font-weight: bold;"> Estado Actual      |      Especialista      |   Actividad en semana actual     |    última orientacion/comparecencia<em class="formee-req">*</em></label>
              <%if current_user.has_role?(:ranking)%>
                 <div id ="divespecialistas_ranking" class="grid-12-12">
                <h5>Última actualización: <%=h Time.now.strftime("%d de %B de %Y  /  %H:%M:%S %p")%></h5>
                <%if @extra%>
                    <%= select :user_id, @especialistas.collect{|a| [a.full_description_for_especialistas, a.id]}%>
                <%else%>
                    <%if @especialista%>
                          &nbsp;
                      <%else%>
                            <%= select :orientacion, :user_id, @especialistas.collect{|a| [a.full_description_for_especialistas, a.id]}, {:selected => @especialistas.first}, :include_blank => true%>
                      <%end%>
                <%end%>
              </div>
              <%else%>
                <div id="divespecialistas_noranking" class="grid-12-12">
                       <h5>Última actualización: <%=h Time.now.strftime("%d de %B de %Y  /  %H:%M:%S %p")%></h5>
                       <%= select :orientacion, :user_id, @especialistas.collect{|a| [a.full_description_for_especialistas, a.id]}, {:selected => @especialistas.first}, :disabled => true%>
                </div>
              <%end%>
        </div>
     </div>
    <%end%>

      <div class="grid-2-12">
      <%if current_user.has_role?(:ranking)%>
                <div id ="prueba"></div>
                <p><%=link_to_remote "- ACTUALIZAR LISTA - ", :update => "divespecialistas", :url => { :action => "update_lista_especialistas", :controller => "orientacions", :orientacion => @orientacion, :tramite_id => @tramite, :extra => @extra },
                              404 => "alert('Not found...? Wrong URL...?')",
                              :before => "Element.show('spinner')",
                              :success => "Element.hide('spinner')",
                              :with => "'model[textfield]=' + $F('orientacion_user_id')",
                              :failure => "alert('HTTP Error ' + request.status + '!')"%>
                </p>
            <%end%>
      </div>
    

        
     <!-- segunda linea -->

     <div class="grid-3-12">
        <label style=" font-weight: bold;">Apellido Paterno: <em class="formee-req">*</em></label>
        <div class="grid-12-12">
          <%= f.text_field :paterno, :onBlur=>"javascript:{this.value = this.value.toUpperCase(); }", :onKeyPress => "return CharNum(event, 'letra');", :required => true, :size => 24%>
        </div>
     </div>

      <div class="grid-3-12">
        <label style=" font-weight: bold;">Apellido Materno:</label>
         <div class="grid-12-12">
        <%= f.text_field :materno, :onBlur=>"javascript:{this.value = this.value.toUpperCase(); }", :onKeyPress => "return CharNum(event, 'letra');", :size => 24%>
         </div>
      </div>
      
      <div class="grid-4-12">
        <label style=" font-weight: bold;">Nombre(s): <em class="formee-req">*</em></label>
         <div class="grid-12-12">
         <%= f.text_field :nombre, :onBlur=>"javascript:{this.value = this.value.toUpperCase(); }", :onKeyPress => "return CharNum(event, 'letra');", :required => true, :size => 32%>
         </div>
      </div>

       <div class="grid-2-12">
        <label style=" font-weight: bold;">Sexo: <em class="formee-req">*</em></label>
        <div class="grid-12-12">
            <%= f.select(:sexo, { "Femenino" => "F", "Masculino" => "M"}, :include_blank => true) %>
        </div>
      </div>

      <div class="grid-12-12 clear"></div>

     
      <!-- tercera linea -->

      <div class="grid-5-12">
        <label style=" font-weight: bold;">Dirección: <em class="formee-req">*</em></label>
         <div class="grid-12-12">
               <%= f.text_area :direccion, :onBlur=>"javascript:{this.value = this.value.toUpperCase(); }", :class => "text", :size => "28x7", :required => true%>
         </div>
       </div>

        <div class="grid-7-12">
        <label style=" font-weight: bold;">País:</label>
         <div class="grid-12-12">
            <%default_pais =Pais.find(:first, :conditions => ["clave = ? ", 'MX'])%>
            <%= f.select :pais_id, Pais.find(:all, :order => "descripcion").collect{|a| [a.descripcion, a.id]}, {:selected =>default_pais.id}, {:onchange => "showHideListadoDeEstados('orientacion_pais_id', 'estados_municipios', 'orientacion_municipio_id', 156);"}%>
         </div>
      </div>

      <div id="estados_municipios" class="grid-8-12">
        <label style=" font-weight: bold;">Estado / Municipio:</label>
         <div class="grid-12-12">
             <%estado_default = Estado.find_by_descripcion("CHIAPAS")%>
             <%default = Municipio.find(:first, :conditions => ["estado_id = ? and descripcion like ?", estado_default.id, "%#{LUGAR}%"])%>
            <%= f.select :municipio_id, Municipio.find(:all, :order => "estado_id").collect{|a| [a.descripcion_jerarquica, a.id]}, :prompt => 'Seleccione una opción', :selected =>default.id%>
         </div>
      </div>

      <div class="grid-4-12">
        <label style=" font-weight: bold;">Teléfono:</label>
         <div class="grid-12-12">
            <%= f.text_field :telefono, :onKeyPress => "return CharNum(event, 'numero');", :class => "text", :size => 19%>
          </div>
       </div>

       <div class="grid-3-12">
        <label style=" font-weight: bold;">Correo: </label>
        <div class="grid-12-12">
            <%= f.text_field :correo, :size => 28%>
        </div>
      </div>


     <!-- cuarta linea --->
      <div class="grid-9-12">
        <label style=" font-weight: bold;">Observaciones y/o comentarios: </label>
        <div class="grid-12-12">
            <%= f.text_area :observaciones, :onBlur=>"javascript:{this.value = this.value.toUpperCase(); }", :size => "88x4"%>        </div>
      </div>
</fieldset>
      
  </tr>

    <tr>
    <td align="right">
      <table>
        <tr>
          <td>
            <input id="button4" class="buttonText" type="submit" title="Guardar y Regresar" value="Guardar y Regresar"  />
          </td>
          <td>
            <a href="/home" id="buttonc" class="buttonText"><img src="/images/formee/form-ic-error.png"/>&nbsp;&nbsp;Regresar sin Guardar</a>
          </td>
        </tr>
        <tr>
          <td colspan="2" >&nbsp;</td>
        </tr>
      </table>
    </td>
  </tr>

  </table>



<%end%>

  </div>



<script type="text/javascript">
  var domicilio = new LiveValidation( 'orientacion_direccion' );
  var nombre = new LiveValidation( 'orientacion_nombre' );
  var sexo = new LiveValidation( 'orientacion_sexo' );
  domicilio.add( Validate.Presence );
  nombre.add( Validate.Presence );
  sexo.add( Validate.Presence );
  domicilio.add( Validate.Length, { maximum: 160 } );
</script>

   


<script type="text/javascript">
  showHideListadoDeEstados('orientacion_pais_id', 'estados_municipios', 'orientacion_municipio_id', 156);
</script>


<!-- Actualizacion de listado -->
<%=periodically_call_remote(:url => {:controller => "orientacions",
                            :action => "update_lista_especialistas",  :orientacion => @orientacion, :tramite_id => @tramite, :extra => @extra},
                            :frequency => '60',
                            :before => "Element.show('spinner')",
                            :success => "Element.hide('spinner')",
                            :with => "'model[textfield]=' + $F('orientacion_user_id')",
                            :update => { :success => "divespecialistas", :failure => "error" })%>
