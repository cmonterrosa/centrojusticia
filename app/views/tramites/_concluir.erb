<!-- Validate Plugin -->
<%=javascript_include_tag "validations/jquery_validate.js"%>
<%=javascript_include_tag "fancybox/jquery-1.8.0.min"%>

<%=javascript_include_tag :defaults%>

<script  type="text/javascript">
  var statSend = false;
  function checkSubmit() {
    if (!statSend) {
        statSend = true;
        return true;
    } else {
        alert("El formulario ya se esta enviando...");
        return false;
    }
}
</script>


<div class="container">
  <%=render :partial => "layouts/notificaciones_acciones"%>

  <div class="formee-msg-info">
    <h3>Informaci√≥n importante</h3>
    <ul>
      <li>Los campos marcados con <em class="formee-req">*</em> son obligatorios.</li>
    </ul>
    <ul><li>&nbsp;</li></ul>
  </div>

<% form_for :concluido, @concluido, :url => { :action => "concluir",  :id => @tramite, :sesion => @sesion}, :html => {:class => "formee", :onsubmit => "return checkSubmit();" } do |f| -%>
  <table width="9%" border="0" align="center" cellpadding="2" cellspacing="1">
    <tr>
  <fieldset>
    <legend style="font-size: 17px;">CONCLUIR&nbsp;EXPEDIENTE&nbsp;&nbsp;<b style="color:  #3079ed;"><%=h @tramite.numero_expediente%></b></legend>

    <%if @comparecencia%>
        <!-- primera linea -->
          <div class="grid-6-12">
            <label style=" font-weight: bold;">SOLICITANTES:</label>
            <div class="grid-12-12">
              <%=h @comparecencia.solicitantes%>
            </div>
          </div>

          <!-- primera linea -->
        <div class="grid-6-12">
            <label style=" font-weight: bold;">INVOLUCRADOS: </label>
            <div class="grid-12-12">
              <%=h @comparecencia.involucrados%>
          </div>
        </div>
     <%end%>


       <!-- primera linea -->
     <%if current_user.has_role?(:direccion) || current_user.has_role?(:subdireccion) || current_user.has_role?(:especialistas)%>
     <div class="grid-8-12">
        <label style=" font-weight: bold;">Fecha/hora : <em class="formee-req">*</em></label>
         <div class="grid-12-12">
            <span class="datetime">
                  <%=datetime_select :concluido, :created_at, :value => @fecha%>
            </span>
         </div>
      </div>
     <%end%>


       <!-- primera linea -->
     <div class="grid-8-12">
        <label style=" font-weight: bold;">SELECCIONE UN MOTIVO: <em class="formee-req">*</em></label>
         <div class="grid-12-12">
          <%= f.select(:motivo_conclusion_id, @motivos_conclusion.collect {|p| [ p.fundamento, p.id ] }, { :include_blank => true })%>
         </div>
      </div>

              <!-- primera linea -->
     <div class="grid-12-12">
       <img alt="spinner" id="spinner" src="/images/loading_spinner.gif" style="display:none;" />
       <div class="grid-12-12" id="descripcion_motivo">

       </div>
      </div>





        <!-- primera linea -->
     <div class="grid-12-12">
        <label style=" font-weight: bold;">OBSERVACIONES: <em class="formee-req">*</em></label>
         <div class="grid-12-12">
          <%= f.text_area :observaciones_conclusion%>
         </div>
      </div>

      <div class="grid-12-12 clear"></div>
 </fieldset>
  </tr>

    <tr>
    <td align="right">
      <table>
        
        
          <tr>
            <td>
              <input id="button4" class="buttonText" type="submit" title="Guardar y Regresar" value="Guardar y Regresar"  />
            </td>

             <%if @sesion%>
                <td>
                    <a href="/sesiones/show_window/<%=h @sesion.id%>" id="buttonc" class="buttonText"><img src="/images/formee/form-ic-error.png"/>&nbsp;&nbsp;Regresar sin Guardar</a>
                </td>
            <%end%>
          </tr>
        
        <tr>
          <td colspan="2" >&nbsp;</td>
        </tr>
      </table>
    </td>
  </tr>

  </table>



<%end%>

      
<%= observe_field 'concluido_motivo_conclusion_id',
    :on => "change",
    :before => "Element.show('spinner')",
    :success => "Element.hide('spinner')",
    :url => {:controller => 'tramites',
    :action => 'get_descripcion_motivo_conclusion'},
    :update => 'descripcion_motivo',
    :with => "concluido_motivo_conclusion_id"%>


<script type="text/javascript">
  var motivo = new LiveValidation( 'concluido_motivo_conclusion_id' );
  motivo.add( Validate.Presence );
</script>
</div>





